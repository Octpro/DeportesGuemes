<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- <meta> http-equiv="X-UA-Compatible" content = "IE-edge" -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deportes Guemes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/color-system.css">
    <link rel="stylesheet" href="./css/text-visibility-fixes.css">
    <link rel="stylesheet" href="./css/animations.css">
    <link rel="stylesheet" href="./css/final-text-visibility-fix.css">
    <link rel="stylesheet" href="./css/interactive-states.css">
    <link rel="stylesheet" href="./css/menu-buttons-fix.css">
    <link rel="stylesheet" href="./css/cart-products.css">
    <link rel="stylesheet" href="./css/cart-mobile-simple.css">
    <link rel="stylesheet" href="./css/cart-mobile-emergency-fix.css">

</head>

<body>
    <!-- Skip Navigation Links -->
    <a href="#main-content" class="skip-nav">Saltar al contenido principal</a>
    <a href="#navigation" class="skip-nav">Saltar a la navegación</a>
    
    <!-- Live Region for Screen Reader Announcements -->
    <div id="live-region" class="live-region" aria-live="polite" aria-atomic="true"></div>

    <div class="wrapper">
        <header class="header-movile" role="banner">
            <a href="index.html" aria-label="Deportes Güemes - Ir a página principal">
                <h1 class="logo">Deportes Güemes</h1>
            </a>
            <button class="open-menu" id="open-menu" aria-label="Abrir menú de navegación" aria-expanded="false" aria-controls="navigation">
                <i class="bi bi-list" aria-hidden="true"></i>
            </button>
        </header>
        <aside role="complementary">
            <button class="close-menu" id="close-menu" aria-label="Cerrar menú de navegación">
                <i class="bi bi-x" aria-hidden="true"></i>
            </button>

            <header>
                <a href="index.html" aria-label="Deportes Güemes - Ir a página principal">
                    <h1 class="logo">Deportes Güemes</h1>
                </a>
            </header>
            <nav id="navigation" role="navigation" aria-label="Navegación principal">
                <ul role="menubar">
                    <li role="none">
                        <a class="boton-menu boton-volver" href="index.html" role="menuitem" aria-describedby="volver-desc">
                            <i class="bi bi-arrow-return-left" aria-hidden="true"></i>
                            Seguir comprando
                        </a>
                        <span id="volver-desc" class="sr-only">Volver a la tienda para seguir comprando</span>
                    </li>
                    <li role="none">
                        <a class="boton-menu boton-carrito active" href="carrito.html" role="menuitem" aria-current="page" aria-describedby="carrito-desc">
                            <i class="bi bi-cart-fill" aria-hidden="true"></i>
                            Carrito
                        </a>
                        <span id="carrito-desc" class="sr-only">Página actual: carrito de compras</span>
                    </li>
                </ul>
            </nav>

            <footer>
                <p class="text-footer">© 2025 Tienda Guemes</p>
            </footer>
        </aside>

        <main id="main-content" role="main" aria-labelledby="cart-title">
            <!-- Enhanced Cart Header -->
            <header class="cart-header">
                <div class="cart-title-section">
                    <h2 class="titulo-principal" id="cart-title">
                        <i class="bi bi-cart3" aria-hidden="true"></i>
                        Mi Carrito
                    </h2>
                    <div class="cart-summary-badge" id="cart-summary-badge" aria-live="polite">
                        <span id="cart-item-count" aria-label="cantidad de productos en el carrito">0</span> productos
                    </div>
                </div>
                <div class="cart-actions-header" role="group" aria-label="Acciones del carrito">
                    <button id="save-for-later" class="btn-secondary btn-icon" aria-label="Guardar carrito para después">
                        <i class="bi bi-bookmark" aria-hidden="true"></i>
                    </button>
                    <button id="share-cart" class="btn-secondary btn-icon" aria-label="Compartir carrito">
                        <i class="bi bi-share" aria-hidden="true"></i>
                    </button>
                </div>
            </header>

            <div class="contenedor-carrito">
                <!-- Empty Cart State -->
                <section id="carrito-vacio" class="carrito-vacio-modern" role="status" aria-labelledby="empty-cart-title">
                    <div class="empty-cart-illustration" aria-hidden="true">
                        <i class="bi bi-cart-x"></i>
                    </div>
                    <h3 id="empty-cart-title">Tu carrito está vacío</h3>
                    <p>¡Descubre nuestros productos deportivos y encuentra lo que necesitas!</p>
                    <a href="index.html" class="btn-primary btn-large" aria-describedby="continue-shopping-desc">
                        <i class="bi bi-arrow-left" aria-hidden="true"></i>
                        Seguir comprando
                    </a>
                    <span id="continue-shopping-desc" class="sr-only">Volver a la tienda para explorar productos</span>
                </section>

                <!-- Cart Products Container -->
                <section id="carrito-productos" class="carrito-productos-modern disabled" role="region" aria-labelledby="cart-products-title" aria-live="polite">
                    <h3 id="cart-products-title" class="sr-only">Productos en el carrito</h3>
                    <!-- Dynamic content will be inserted here -->
                </section>

                <!-- Cart Summary Sidebar -->
                <aside id="carrito-resumen" class="carrito-resumen disabled" role="complementary" aria-labelledby="resumen-title">
                    <div class="resumen-card">
                        <h3 class="resumen-title" id="resumen-title">
                            <i class="bi bi-receipt" aria-hidden="true"></i>
                            Resumen del pedido
                        </h3>

                        <div class="resumen-details" role="region" aria-live="polite">
                            <div class="resumen-line">
                                <span>Subtotal (<span id="resumen-cantidad" aria-label="cantidad de productos">0</span> productos)</span>
                                <span id="resumen-subtotal" aria-label="subtotal del pedido">$0</span>
                            </div>


                            <hr class="resumen-divider" role="separator">
                            <div class="resumen-line total-line">
                                <span class="total-label">Total</span>
                                <span class="total-amount" id="total" aria-label="total del pedido">$0</span>
                            </div>
                        </div>



                        <!-- Action Buttons -->
                        <div class="cart-actions-main" role="group" aria-label="Acciones principales del carrito">
                            <button id="carrito-acciones-comprar" class="btn-primary btn-large btn-checkout" aria-describedby="whatsapp-help">
                                <i class="bi bi-whatsapp" aria-hidden="true"></i>
                                Consultar por WhatsApp
                            </button>
                            <span id="whatsapp-help" class="sr-only">Envía tu consulta por WhatsApp para finalizar la compra</span>
                            <button id="carrito-acciones-vaciar" class="btn-secondary btn-clear" aria-describedby="vaciar-help">
                                <i class="bi bi-trash3" aria-hidden="true"></i>
                                Vaciar carrito
                            </button>
                            <span id="vaciar-help" class="sr-only">Elimina todos los productos del carrito</span>
                        </div>


                    </div>
                </aside>

                <!-- Success State -->
                <section id="carrito-comprado" class="carrito-comprado-modern disabled" role="status" aria-labelledby="success-title">
                    <div class="success-illustration" aria-hidden="true">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <h3 id="success-title">¡Consulta enviada!</h3>
                    <p>Te contactaremos pronto por WhatsApp para confirmar tu pedido.</p>
                    <div class="success-actions" role="group" aria-label="Acciones después de la consulta">
                        <a href="index.html" class="btn-primary" aria-describedby="continue-desc">Seguir comprando</a>
                        <span id="continue-desc" class="sr-only">Volver a la tienda para seguir comprando</span>
                        <button id="new-consultation" class="btn-secondary" aria-describedby="new-consultation-desc">Nueva consulta</button>
                        <span id="new-consultation-desc" class="sr-only">Iniciar una nueva consulta de productos</span>
                    </div>
                </section>
            </div>

            <!-- Recommended Products Section -->
            <section id="productos-recomendados" class="productos-recomendados disabled" role="region" aria-labelledby="recommended-title">
                <h3 id="recommended-title">También te puede interesar</h3>
                <div class="productos-recomendados-grid" id="productos-recomendados-grid" role="list">
                    <!-- Dynamic content will be inserted here -->
                </div>
            </section>
        </main>
    </div>


    <!-- Essential Scripts for Cart -->
    <script src="JS/simple-cart-manager.js"></script>
    <script src="JS/carrito-fixed.js"></script>
    <script src="JS/direct-stock-fix.js"></script>
    
    <!-- Mobile Cart Fix Script -->
    <script>
        // Force visibility and create missing elements if needed
        function forceMobileCartVisibility() {
            if (window.innerWidth <= 900) {
                console.log('📱 Applying mobile cart visibility fixes...');
                
                // Find or create cart summary
                let cartSummary = document.getElementById('carrito-resumen');
                if (!cartSummary || cartSummary.style.display === 'none' || cartSummary.classList.contains('disabled')) {
                    console.log('🔧 Cart summary not visible, forcing...');
                    
                    if (cartSummary) {
                        cartSummary.style.display = 'block';
                        cartSummary.style.visibility = 'visible';
                        cartSummary.style.opacity = '1';
                        cartSummary.classList.remove('disabled');
                    } else {
                        // Create cart summary if it doesn't exist
                        cartSummary = createCartSummary();
                    }
                    console.log('✅ Cart summary forced visible');
                }
                
                // Find or create action buttons
                let actionButtons = document.querySelector('.cart-actions-main');
                if (!actionButtons || actionButtons.style.display === 'none' || actionButtons.classList.contains('disabled')) {
                    console.log('🔧 Action buttons not visible, forcing...');
                    
                    if (actionButtons) {
                        actionButtons.style.display = 'flex';
                        actionButtons.style.visibility = 'visible';
                        actionButtons.style.opacity = '1';
                        actionButtons.classList.remove('disabled');
                    } else {
                        // Create action buttons if they don't exist
                        actionButtons = createActionButtons();
                    }
                    console.log('✅ Action buttons forced visible');
                }
                
                // Force individual buttons
                const whatsappBtn = document.getElementById('carrito-acciones-comprar');
                const clearBtn = document.getElementById('carrito-acciones-vaciar');
                
                if (whatsappBtn) {
                    whatsappBtn.style.display = 'flex';
                    whatsappBtn.style.visibility = 'visible';
                    whatsappBtn.style.opacity = '1';
                    whatsappBtn.classList.remove('disabled');
                    console.log('✅ WhatsApp button forced visible');
                }
                
                if (clearBtn) {
                    clearBtn.style.display = 'flex';
                    clearBtn.style.visibility = 'visible';
                    clearBtn.style.opacity = '1';
                    clearBtn.classList.remove('disabled');
                    console.log('✅ Clear button forced visible');
                }
            }
        }
        
        // Create cart summary if missing
        function createCartSummary() {
            console.log('🏗️ Creating missing cart summary...');
            
            // Try to find the best container in order of preference
            const container = document.querySelector('.contenedor-carrito') || 
                             document.querySelector('#carrito-productos') ||
                             document.querySelector('main') ||
                             document.querySelector('.wrapper');
            
            if (!container) {
                console.error('No suitable container found');
                return null;
            }
            
            console.log('Using container:', container.className || container.tagName);
            
            // Check screen width for compact version
            const isVerySmall = window.innerWidth <= 300;
            const isSmall = window.innerWidth <= 500;
            
            const summaryHTML = `
                <aside id="carrito-resumen" class="carrito-resumen" style="display: block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important; max-width: 100% !important; box-sizing: border-box !important; position: relative !important; z-index: 100 !important; background: white !important; margin: 1rem 0 !important; left: 0 !important; right: 0 !important;">
                    <div class="resumen-card" style="width: 100% !important; max-width: 100% !important; padding: ${isVerySmall ? '0.5rem' : '0.75rem'} !important; box-sizing: border-box !important; font-size: ${isVerySmall ? '0.8rem' : '0.9rem'} !important;">
                        <h3 class="resumen-title" style="font-size: ${isVerySmall ? '0.9rem' : '1rem'} !important; margin-bottom: 0.75rem !important;">
                            <i class="bi bi-receipt"></i>
                            ${isVerySmall ? 'Resumen' : 'Resumen del pedido'}
                        </h3>
                        <div class="resumen-details">
                            <div class="resumen-line" style="font-size: ${isVerySmall ? '0.75rem' : '0.85rem'} !important;">
                                <span>Subtotal (<span id="resumen-cantidad">3</span> productos)</span>
                                <span id="resumen-subtotal">$47997</span>
                            </div>
                            <hr class="resumen-divider">
                            <div class="resumen-line total-line" style="font-size: ${isVerySmall ? '0.8rem' : '0.9rem'} !important; font-weight: bold !important;">
                                <span class="total-label">Total</span>
                                <span class="total-amount" id="total">$47997</span>
                            </div>
                        </div>
                        <div class="cart-actions-main" style="display: flex !important; flex-direction: column !important; gap: ${isVerySmall ? '0.3rem' : '0.5rem'} !important; visibility: visible !important; opacity: 1 !important; margin-top: 1rem !important; padding: ${isVerySmall ? '0.5rem' : '0.75rem'} 0 !important;">
                            <button id="carrito-acciones-comprar" class="btn-primary btn-large btn-checkout" style="display: flex !important; background-color: #25d366; color: white; width: 100%; justify-content: center; align-items: center; gap: 0.3rem; padding: ${isVerySmall ? '0.6rem 0.3rem' : '0.75rem 0.5rem'} !important; border-radius: 6px; border: none; font-size: ${isVerySmall ? '0.75rem' : '0.85rem'} !important; box-sizing: border-box !important;">
                                <i class="bi bi-whatsapp"></i>
                                ${isVerySmall ? 'WhatsApp' : 'Consultar por WhatsApp'}
                            </button>
                            <button id="carrito-acciones-vaciar" class="btn-secondary btn-clear" style="display: flex !important; background-color: #dc3545; color: white; width: 100%; justify-content: center; align-items: center; gap: 0.3rem; padding: ${isVerySmall ? '0.6rem 0.3rem' : '0.75rem 0.5rem'} !important; border-radius: 6px; border: none; font-size: ${isVerySmall ? '0.75rem' : '0.85rem'} !important; box-sizing: border-box !important;">
                                <i class="bi bi-trash3"></i>
                                ${isVerySmall ? 'Vaciar' : 'Vaciar carrito'}
                            </button>
                        </div>
                    </div>
                </aside>
            `;
            
            // Insert after the cart products, not at the end of container
            const cartProducts = document.querySelector('#carrito-productos');
            if (cartProducts && cartProducts.parentNode) {
                cartProducts.parentNode.insertAdjacentHTML('beforeend', summaryHTML);
            } else {
                container.insertAdjacentHTML('beforeend', summaryHTML);
            }
            
            // Setup event listeners for the new buttons
            setupNewButtonEvents();
            
            return document.getElementById('carrito-resumen');
        }
        
        // Create action buttons if missing
        function createActionButtons() {
            console.log('🏗️ Creating missing action buttons...');
            
            const container = document.querySelector('.contenedor-carrito');
            if (!container) return null;
            
            const buttonsHTML = `
                <div class="cart-actions-main" style="display: flex !important; flex-direction: column; gap: 0.75rem; width: 100%; padding: 1rem 0; visibility: visible !important; opacity: 1 !important;">
                    <button id="carrito-acciones-comprar" class="btn-primary btn-large btn-checkout" style="display: flex !important; background-color: #25d366; color: white; width: 100%; justify-content: center; align-items: center; gap: 0.5rem; padding: 1rem; border-radius: 8px; border: none;">
                        <i class="bi bi-whatsapp"></i>
                        Consultar por WhatsApp
                    </button>
                    <button id="carrito-acciones-vaciar" class="btn-secondary btn-clear" style="display: flex !important; background-color: #dc3545; color: white; width: 100%; justify-content: center; align-items: center; gap: 0.5rem; padding: 0.75rem; border-radius: 8px; border: none;">
                        <i class="bi bi-trash3"></i>
                        Vaciar carrito
                    </button>
                </div>
            `;
            
            // Find the main content area instead of just any container
            const mainContent = document.querySelector('main') || container;
            mainContent.insertAdjacentHTML('beforeend', buttonsHTML);
            
            // Setup event listeners for the new buttons
            setupNewButtonEvents();
            
            return document.querySelector('.cart-actions-main');
        }
        
        // Setup event listeners for newly created buttons
        function setupNewButtonEvents() {
            const whatsappBtn = document.getElementById('carrito-acciones-comprar');
            const clearBtn = document.getElementById('carrito-acciones-vaciar');
            
            if (whatsappBtn && !whatsappBtn.dataset.eventSetup) {
                whatsappBtn.addEventListener('click', sendWhatsAppMessage);
                whatsappBtn.dataset.eventSetup = 'true';
                console.log('✅ WhatsApp button event setup');
            }
            
            if (clearBtn && !clearBtn.dataset.eventSetup) {
                clearBtn.addEventListener('click', clearCart);
                clearBtn.dataset.eventSetup = 'true';
                console.log('✅ Clear button event setup');
            }
        }
        
        // Apply fixes when DOM is ready
        document.addEventListener('DOMContentLoaded', forceMobileCartVisibility);
        
        // Apply fixes after cart loads
        setTimeout(forceMobileCartVisibility, 1000);
        setTimeout(forceMobileCartVisibility, 2000);
        
        // Apply fixes on window resize
        window.addEventListener('resize', forceMobileCartVisibility);
        
        // Override the displayCartItems function to ensure visibility
        const originalDisplayCartItems = window.displayCartItems;
        if (originalDisplayCartItems) {
            window.displayCartItems = function(items) {
                originalDisplayCartItems(items);
                setTimeout(forceMobileCartVisibility, 100);
            };
        }
        
        // WhatsApp function
        function sendWhatsAppMessage() {
            try {
                const productosEnCarrito = JSON.parse(localStorage.getItem("productos-en-carrito") || "[]");
                
                if (productosEnCarrito.length === 0) {
                    alert('Tu carrito está vacío');
                    return;
                }
                
                let message = "¡Hola! Me interesa consultar por estos productos:\n\n";
                let total = 0;
                
                productosEnCarrito.forEach((item, index) => {
                    const subtotal = parseFloat(item.precio) * item.cantidad;
                    total += subtotal;
                    
                    message += `${index + 1}. ${item.titulo}\n`;
                    if (item.talle && item.talle !== 'Único') {
                        message += `   Talle: ${item.talle}\n`;
                    }
                    message += `   Cantidad: ${item.cantidad}\n`;
                    message += `   Precio: ${item.precio} c/u\n`;
                    message += `   Subtotal: ${subtotal.toFixed(0)}\n\n`;
                });
                
                message += `Total: ${total.toFixed(0)}\n\n`;
                message += "¿Podrían confirmarme disponibilidad y forma de pago?";
                
                const phoneNumber = "5491234567890";
                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
                
                window.open(whatsappUrl, '_blank');
                
            } catch (error) {
                console.error('Error sending WhatsApp message:', error);
                alert('Error al generar el mensaje de WhatsApp');
            }
        }
        
        // Clear cart function
        function clearCart() {
            if (confirm('¿Estás seguro de que quieres vaciar el carrito?')) {
                localStorage.removeItem("productos-en-carrito");
                location.reload();
            }
        }
    </script>
</body>

</html>