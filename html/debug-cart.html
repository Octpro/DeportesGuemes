<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Cart</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Cart Debug</h1>
    
    <button onclick="checkCartManager()">Check Cart Manager</button>
    <button onclick="addTestProduct()">Add Test Product</button>
    <button onclick="checkLocalStorage()">Check localStorage</button>
    <button onclick="openCartPage()">Open Cart Page</button>
    
    <div id="debug-output"></div>

    <script src="JS/simple-cart-manager.js"></script>
    <script>
        function log(message, type = 'debug') {
            const output = document.getElementById('debug-output');
            const div = document.createElement('div');
            div.className = `debug ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            output.appendChild(div);
            console.log(message);
        }

        function checkCartManager() {
            log('Checking cart manager availability...');
            
            if (typeof window.cartManager !== 'undefined') {
                log('‚úÖ Cart manager is available', 'success');
                
                try {
                    const cart = window.cartManager.loadCart();
                    log(`üì¶ Cart loaded: ${cart.length} products`, 'success');
                    log(`Cart contents: ${JSON.stringify(cart, null, 2)}`);
                    
                    const summary = window.cartManager.getCartSummary();
                    log(`üìä Cart summary: ${JSON.stringify(summary, null, 2)}`, 'success');
                } catch (error) {
                    log(`‚ùå Error loading cart: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå Cart manager is NOT available', 'error');
            }
        }

        function addTestProduct() {
            const testProduct = {
                id: "debug_test_001",
                titulo: "Debug Test Product",
                precio: 1000,
                imagen: "./img/placeholder.png",
                genero: "Unisex",
                talles: ["M", "L"],
                color: "Rojo"
            };

            log('Adding test product...');
            
            if (window.cartManager) {
                try {
                    const success = window.cartManager.addProduct(testProduct);
                    if (success) {
                        log('‚úÖ Test product added successfully', 'success');
                        checkCartManager();
                    } else {
                        log('‚ùå Failed to add test product', 'error');
                    }
                } catch (error) {
                    log(`‚ùå Error adding product: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå Cart manager not available', 'error');
            }
        }

        function checkLocalStorage() {
            log('Checking localStorage...');
            
            try {
                const cartData = localStorage.getItem('productos-en-carrito');
                if (cartData) {
                    const parsed = JSON.parse(cartData);
                    log(`üì¶ localStorage cart: ${parsed.length} products`, 'success');
                    log(`localStorage contents: ${JSON.stringify(parsed, null, 2)}`);
                } else {
                    log('üì≠ No cart data in localStorage');
                }
            } catch (error) {
                log(`‚ùå Error reading localStorage: ${error.message}`, 'error');
            }
        }

        function openCartPage() {
            window.open('carrito.html', '_blank');
        }

        // Auto-check on load
        setTimeout(() => {
            log('üöÄ Page loaded, checking cart manager...');
            checkCartManager();
        }, 100);
    </script>
</body>
</html>